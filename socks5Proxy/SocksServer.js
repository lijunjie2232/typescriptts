'use strict';var a11_0x59ca4d=a11_0x2a9b;function a11_0x2a9b(_0x42c12e,_0x27ca97){var _0x45de8e=a11_0x45de();return a11_0x2a9b=function(_0x2a9b27,_0x5c6468){_0x2a9b27=_0x2a9b27-0xd7;var _0x34dda2=_0x45de8e[_0x2a9b27];return _0x34dda2;},a11_0x2a9b(_0x42c12e,_0x27ca97);}(function(_0x5ae976,_0x5c7838){var _0x346453=a11_0x2a9b,_0x5e95a0=_0x5ae976();while(!![]){try{var _0x4559b4=parseInt(_0x346453(0xe8))/0x1+parseInt(_0x346453(0x11c))/0x2*(-parseInt(_0x346453(0x120))/0x3)+parseInt(_0x346453(0x107))/0x4*(parseInt(_0x346453(0xe3))/0x5)+-parseInt(_0x346453(0xeb))/0x6+-parseInt(_0x346453(0x10e))/0x7+parseInt(_0x346453(0xf6))/0x8*(parseInt(_0x346453(0xfb))/0x9)+parseInt(_0x346453(0x105))/0xa*(parseInt(_0x346453(0x11f))/0xb);if(_0x4559b4===_0x5c7838)break;else _0x5e95a0['push'](_0x5e95a0['shift']());}catch(_0x33d3b6){_0x5e95a0['push'](_0x5e95a0['shift']());}}}(a11_0x45de,0xe8510));var __createBinding=this&&this[a11_0x59ca4d(0xdc)]||(Object[a11_0x59ca4d(0xf3)]?function(_0x290bde,_0x35e6f4,_0x56b555,_0x375791){var _0x3772dd=a11_0x59ca4d;if(_0x375791===undefined)_0x375791=_0x56b555;var _0x13133c=Object[_0x3772dd(0xd7)](_0x35e6f4,_0x56b555);(!_0x13133c||(_0x3772dd(0x108)in _0x13133c?!_0x35e6f4[_0x3772dd(0xfd)]:_0x13133c[_0x3772dd(0x100)]||_0x13133c[_0x3772dd(0x103)]))&&(_0x13133c={'enumerable':!![],'get':function(){return _0x35e6f4[_0x56b555];}}),Object[_0x3772dd(0x11a)](_0x290bde,_0x375791,_0x13133c);}:function(_0x3bf541,_0xab307b,_0x1fe07b,_0x2cfe1d){if(_0x2cfe1d===undefined)_0x2cfe1d=_0x1fe07b;_0x3bf541[_0x2cfe1d]=_0xab307b[_0x1fe07b];}),__setModuleDefault=this&&this[a11_0x59ca4d(0xf9)]||(Object['create']?function(_0x241804,_0x3a6211){var _0x5ef690=a11_0x59ca4d;Object[_0x5ef690(0x11a)](_0x241804,_0x5ef690(0xed),{'enumerable':!![],'value':_0x3a6211});}:function(_0x89eb11,_0x224d48){var _0xc58333=a11_0x59ca4d;_0x89eb11[_0xc58333(0xed)]=_0x224d48;}),__importStar=this&&this[a11_0x59ca4d(0x114)]||function(_0x39191d){var _0x2a905c=a11_0x59ca4d;if(_0x39191d&&_0x39191d['__esModule'])return _0x39191d;var _0x3d92d5={};if(_0x39191d!=null){for(var _0x7da3c6 in _0x39191d)if(_0x7da3c6!==_0x2a905c(0xed)&&Object[_0x2a905c(0x121)][_0x2a905c(0x125)][_0x2a905c(0x113)](_0x39191d,_0x7da3c6))__createBinding(_0x3d92d5,_0x39191d,_0x7da3c6);}return __setModuleDefault(_0x3d92d5,_0x39191d),_0x3d92d5;},__awaiter=this&&this[a11_0x59ca4d(0x104)]||function(_0xc6952e,_0x5480c9,_0x16b961,_0x219618){function _0xe8bdad(_0x3d66c8){return _0x3d66c8 instanceof _0x16b961?_0x3d66c8:new _0x16b961(function(_0x2cb8d0){_0x2cb8d0(_0x3d66c8);});}return new(_0x16b961||(_0x16b961=Promise))(function(_0x5a4a1e,_0x2b6b0c){var _0x2e55d2=a11_0x2a9b;function _0x19165d(_0x844e42){var _0x364aa4=a11_0x2a9b;try{_0x13a4bd(_0x219618[_0x364aa4(0x124)](_0x844e42));}catch(_0x41c501){_0x2b6b0c(_0x41c501);}}function _0x368415(_0x2662b8){var _0x434571=a11_0x2a9b;try{_0x13a4bd(_0x219618[_0x434571(0xe9)](_0x2662b8));}catch(_0x28cd3f){_0x2b6b0c(_0x28cd3f);}}function _0x13a4bd(_0x13f23a){var _0x850deb=a11_0x2a9b;_0x13f23a[_0x850deb(0x10b)]?_0x5a4a1e(_0x13f23a[_0x850deb(0xf5)]):_0xe8bdad(_0x13f23a[_0x850deb(0xf5)])[_0x850deb(0xf7)](_0x19165d,_0x368415);}_0x13a4bd((_0x219618=_0x219618[_0x2e55d2(0x11d)](_0xc6952e,_0x5480c9||[]))[_0x2e55d2(0x124)]());});};Object[a11_0x59ca4d(0x11a)](exports,a11_0x59ca4d(0xfd),{'value':!![]}),exports[a11_0x59ca4d(0xe5)]=void 0x0;function a11_0x45de(){var _0x1f10e3=['size','Connection\x20closed\x20from\x20socket\x20:\x20','Closing\x20the\x20server...','clear','40DdiewZ','includes','SocksServer','maxFailedAttempts','authentication','705002akmGbo','throw','bind','10494072eWreWR','destroy','default','net','config','remotePort','handleConnection','Error\x20starting\x20SOCKS5\x20server:\x20','create','isWhitelistedIP','value','499304RKMBia','then','Server\x20error:\x20','__setModuleDefault','serverIP','234ibeGOH','clientIpFiltering','__esModule','push','ConfigManager','writable','server','Server','configurable','__awaiter','10865270kggooU','logger','633132uSHMGR','get','SocksSession','Connection\x20limit\x20reached.\x20Rejecting\x20new\x20connection\x20from\x20','done','../ConfigManager','info','10801091iasTVT','port','message','blacklist','Client\x20not\x20in\x20the\x20whitelist:\x20','call','__importStar','error','add','incrementAuthFailure','maxConcurrentConnections','Error\x20closing\x20SOCKS5\x20server:\x20','defineProperty','remoteAddress','4NpKFAQ','apply','close','11MkHxZQ','655407GFTLcW','prototype','activeConnections','configManager','next','hasOwnProperty','getOwnPropertyDescriptor','socks5','Blacklisting\x20IP\x20due\x20to\x20too\x20many\x20failed\x20attempts:\x20','connection','Closed\x20active\x20connections','__createBinding','New\x20connection\x20on\x20server\x20from\x20socket\x20:\x20','failedAuthAttempts'];a11_0x45de=function(){return _0x1f10e3;};return a11_0x45de();}const net=__importStar(require(a11_0x59ca4d(0xee))),SocksSession_1=require('./SocksSession'),ConfigManager_1=require(a11_0x59ca4d(0x10c));class SocksServer{constructor(_0x590c66,_0xee9724){var _0x5f0ad6=a11_0x59ca4d;this[_0x5f0ad6(0x123)]=new ConfigManager_1[(_0x5f0ad6(0xff))](_0x590c66),this[_0x5f0ad6(0x101)]=new net[(_0x5f0ad6(0x102))](),this['activeConnections']=new Set(),this[_0x5f0ad6(0x106)]=_0xee9724,this[_0x5f0ad6(0xde)]=new Map(),this[_0x5f0ad6(0x101)]['on'](_0x5f0ad6(0xda),this[_0x5f0ad6(0xf1)]['bind'](this)),this['server']['on'](_0x5f0ad6(0x115),_0x1ba3f3=>{var _0x300bbf=_0x5f0ad6;this[_0x300bbf(0x106)][_0x300bbf(0x115)](_0x300bbf(0xf8)+_0x1ba3f3[_0x300bbf(0x110)]);});}[a11_0x59ca4d(0xf1)](_0x3e543c){var _0x1591bc=a11_0x59ca4d;;const _0x5f52c7=_0x3e543c[_0x1591bc(0x11b)]||'';this['logger'][_0x1591bc(0x10d)](_0x1591bc(0xdd)+_0x3e543c[_0x1591bc(0x11b)]+':'+_0x3e543c[_0x1591bc(0xf0)]);if(this[_0x1591bc(0x122)][_0x1591bc(0xdf)]>=this['configManager'][_0x1591bc(0xef)][_0x1591bc(0x101)][_0x1591bc(0x118)]){this[_0x1591bc(0x106)]['info'](_0x1591bc(0x10a)+_0x5f52c7),_0x3e543c[_0x1591bc(0xec)]();return;}if(this[_0x1591bc(0x123)]['config'][_0x1591bc(0xfc)][_0x1591bc(0x111)][_0x1591bc(0xe4)](_0x5f52c7)){this[_0x1591bc(0x106)][_0x1591bc(0x10d)]('Rejected\x20blacklisted\x20IP:\x20'+_0x5f52c7),_0x3e543c[_0x1591bc(0xec)]();return;}if(!this[_0x1591bc(0xf4)](_0x5f52c7)){this[_0x1591bc(0x106)]['info'](_0x1591bc(0x112)+_0x5f52c7),_0x3e543c[_0x1591bc(0xec)]();return;}this[_0x1591bc(0x122)][_0x1591bc(0x116)](_0x3e543c),_0x3e543c['on']('close',()=>{var _0x3670fb=_0x1591bc;this['logger'][_0x3670fb(0x10d)](_0x3670fb(0xe0)+_0x3e543c[_0x3670fb(0x11b)]+':'+_0x3e543c[_0x3670fb(0xf0)]),this[_0x3670fb(0x122)]['delete'](_0x3e543c);}),new SocksSession_1[(_0x1591bc(0x109))](_0x3e543c,this[_0x1591bc(0x123)],this[_0x1591bc(0x106)],this[_0x1591bc(0x117)][_0x1591bc(0xea)](this));}[a11_0x59ca4d(0xf4)](_0x34742c){var _0x1dc1c9=a11_0x59ca4d;const _0x5d95ad=this[_0x1dc1c9(0x123)]['config'][_0x1dc1c9(0xfc)]['whitelist'];if(!_0x5d95ad||_0x5d95ad['length']===0x0)return!![];return _0x5d95ad[_0x1dc1c9(0xe4)](_0x34742c||'');}[a11_0x59ca4d(0x117)](_0x37eab6){var _0x5e15bc=a11_0x59ca4d;const _0x3d43a1=(this[_0x5e15bc(0xde)][_0x5e15bc(0x108)](_0x37eab6)||0x0)+0x1;this['failedAuthAttempts']['set'](_0x37eab6,_0x3d43a1),_0x3d43a1>=this[_0x5e15bc(0x123)][_0x5e15bc(0xef)][_0x5e15bc(0xe7)][_0x5e15bc(0xe6)]&&(this[_0x5e15bc(0x106)][_0x5e15bc(0x10d)](_0x5e15bc(0xd9)+_0x37eab6),this[_0x5e15bc(0x123)][_0x5e15bc(0xef)]['clientIpFiltering'][_0x5e15bc(0x111)][_0x5e15bc(0xfe)](_0x37eab6));}['start'](){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise((_0x40cf88,_0x204693)=>{var _0x5cfa62=a11_0x2a9b;this[_0x5cfa62(0x101)]['listen'](this['configManager'][_0x5cfa62(0xef)]['server'][_0x5cfa62(0xd8)][_0x5cfa62(0x10f)],this[_0x5cfa62(0x123)][_0x5cfa62(0xef)][_0x5cfa62(0x101)]['socks5']['serverIP'],()=>{var _0x131513=_0x5cfa62;this[_0x131513(0x106)][_0x131513(0x10d)]('SOCKS5\x20server\x20listening\x20on\x20'+this[_0x131513(0x123)]['config'][_0x131513(0x101)][_0x131513(0xd8)][_0x131513(0xfa)]+':'+this['configManager']['config']['server']['socks5']['port']),_0x40cf88();}),this[_0x5cfa62(0x101)]['on'](_0x5cfa62(0x115),_0x44d510=>{var _0x38b415=_0x5cfa62;this[_0x38b415(0x106)]['error'](_0x38b415(0xf2)+_0x44d510),_0x204693(_0x44d510);});});});}['close'](){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise((_0x414e0b,_0x341afa)=>{var _0x4f3682=a11_0x2a9b;for(const _0x291c3f of this[_0x4f3682(0x122)]){_0x291c3f[_0x4f3682(0xec)]();}this[_0x4f3682(0x122)][_0x4f3682(0xe2)](),this[_0x4f3682(0x106)][_0x4f3682(0x10d)](_0x4f3682(0xdb)),this[_0x4f3682(0x101)][_0x4f3682(0x11e)](_0x5e8c97=>{var _0x391f55=_0x4f3682;_0x5e8c97?(this[_0x391f55(0x106)][_0x391f55(0x115)](_0x391f55(0x119)+_0x5e8c97),_0x341afa(_0x5e8c97)):(this[_0x391f55(0x106)][_0x391f55(0x10d)](_0x391f55(0xe1)),_0x414e0b());});});});}}exports['SocksServer']=SocksServer;