'use strict';const a10_0x2ae527=a10_0x632b;(function(_0x403266,_0x4c87d9){const _0x12d32e=a10_0x632b,_0x121f1c=_0x403266();while(!![]){try{const _0x5c3f17=parseInt(_0x12d32e(0xbb))/0x1+-parseInt(_0x12d32e(0x91))/0x2*(parseInt(_0x12d32e(0xcd))/0x3)+parseInt(_0x12d32e(0xc7))/0x4*(parseInt(_0x12d32e(0xcb))/0x5)+-parseInt(_0x12d32e(0xaa))/0x6*(-parseInt(_0x12d32e(0xb1))/0x7)+parseInt(_0x12d32e(0xd3))/0x8+parseInt(_0x12d32e(0xa6))/0x9*(parseInt(_0x12d32e(0xb6))/0xa)+-parseInt(_0x12d32e(0xe2))/0xb;if(_0x5c3f17===_0x4c87d9)break;else _0x121f1c['push'](_0x121f1c['shift']());}catch(_0x1743c1){_0x121f1c['push'](_0x121f1c['shift']());}}}(a10_0x4ba2,0x44305));function a10_0x632b(_0x3bca5a,_0xa4d210){const _0x4ba243=a10_0x4ba2();return a10_0x632b=function(_0x632be6,_0x2eb5f0){_0x632be6=_0x632be6-0x8c;let _0x521ef3=_0x4ba243[_0x632be6];return _0x521ef3;},a10_0x632b(_0x3bca5a,_0xa4d210);}function a10_0x4ba2(){const _0x74e22=['udpPort','isWhitelistedIP','DataRelayMode','Cleaned\x20up\x20session','debug','8789132SSfMpR','isBlockedIP','handleData','whitelist','includes','throw','UDP\x20ASSOCIATE\x20command\x20received','AwaitingAuthentication','next','authentication','2038BQZSsz','authenticate','defineProperty','BIND\x20command\x20received','SocksSession','CONNECT\x20command\x20received','end','authHandler','monitor','min','bind','../Auth','value','socks5','BindCommandHandler','then','logger','error','UDP\x20port\x20assigned\x20:\x20','info','length','9nQAjnk','sessionCleanup','slice','handleCommand','92982HmAGmb','__esModule','Received\x20data\x20:\x20','./BindCommandHandler','assignUdpPort','AwaitingInitialCommand','delete','182XPfZjw','UserPassAuth','usedUdpPorts','ConnectCommandHandler','commandHandler','2215090QaQFGL','apply','filterAccess','\x20blocked\x20by\x20server\x20policy','Successfull\x20greeting','472910AaUvps','from','write','serverIpFiltering','remoteAddress','UdpAssociateHandler','data','handleAuth','has','parseDestination','server','configManager','36836NjQGlA','max','clientSocket','config','25EwUXMe','./UDPAssociateCommandHandler','921kcrgkp','done','../utils','isGreetingHandled','password','add','1982080hIuOLj','Successful\x20authentication','./ConnectCommandHandler','AwaitingGreeting','udpPortRange','state','incrementAuthFailure','handleGreeting','__awaiter','Access\x20to\x20IP\x20'];a10_0x4ba2=function(){return _0x74e22;};return a10_0x4ba2();}var __awaiter=this&&this[a10_0x2ae527(0xdb)]||function(_0x2347af,_0x503ea6,_0x3e08ab,_0x4fe8e5){function _0x5bd047(_0x372483){return _0x372483 instanceof _0x3e08ab?_0x372483:new _0x3e08ab(function(_0x21b4a3){_0x21b4a3(_0x372483);});}return new(_0x3e08ab||(_0x3e08ab=Promise))(function(_0x32e61a,_0xabb95b){const _0x46965b=a10_0x632b;function _0x316f03(_0x2449e0){const _0x41df17=a10_0x632b;try{_0x64488(_0x4fe8e5[_0x41df17(0x8f)](_0x2449e0));}catch(_0x225d72){_0xabb95b(_0x225d72);}}function _0x34f1d9(_0x525af1){const _0x4cabcd=a10_0x632b;try{_0x64488(_0x4fe8e5[_0x4cabcd(0x8c)](_0x525af1));}catch(_0x3e7bcc){_0xabb95b(_0x3e7bcc);}}function _0x64488(_0x320255){const _0x5be48c=a10_0x632b;_0x320255[_0x5be48c(0xce)]?_0x32e61a(_0x320255['value']):_0x5bd047(_0x320255[_0x5be48c(0x9d)])[_0x5be48c(0xa0)](_0x316f03,_0x34f1d9);}_0x64488((_0x4fe8e5=_0x4fe8e5[_0x46965b(0xb7)](_0x2347af,_0x503ea6||[]))[_0x46965b(0x8f)]());});};Object[a10_0x2ae527(0x93)](exports,a10_0x2ae527(0xab),{'value':!![]}),exports[a10_0x2ae527(0x95)]=void 0x0;const utils_1=require(a10_0x2ae527(0xcf)),Auth_1=require(a10_0x2ae527(0x9c)),ConnectCommandHandler_1=require(a10_0x2ae527(0xd5)),BindCommandHandler_1=require(a10_0x2ae527(0xad)),UDPAssociateCommandHandler_1=require(a10_0x2ae527(0xcc)),SessionMonitor_1=require('../SessionMonitor');var SocksSessionState;(function(_0x5daa54){const _0x1f860d=a10_0x2ae527;_0x5daa54[_0x5daa54[_0x1f860d(0xd6)]=0x0]=_0x1f860d(0xd6),_0x5daa54[_0x5daa54[_0x1f860d(0x8e)]=0x1]=_0x1f860d(0x8e),_0x5daa54[_0x5daa54[_0x1f860d(0xaf)]=0x2]=_0x1f860d(0xaf),_0x5daa54[_0x5daa54[_0x1f860d(0xdf)]=0x3]=_0x1f860d(0xdf);}(SocksSessionState||(SocksSessionState={})));class SocksSession{constructor(_0x44472e,_0x53f8e8,_0xf4ef28,_0x2bd363){const _0x371d00=a10_0x2ae527;this[_0x371d00(0xc9)]=_0x44472e,this[_0x371d00(0xd8)]=SocksSessionState['AwaitingGreeting'],this['isGreetingHandled']=![],this['handleData']=_0x6d5158=>__awaiter(this,void 0x0,void 0x0,function*(){const _0xd5f2fb=_0x371d00;this['logger'][_0xd5f2fb(0xe1)](_0xd5f2fb(0xac),_0x6d5158);switch(this[_0xd5f2fb(0xd8)]){case SocksSessionState[_0xd5f2fb(0xd6)]:this[_0xd5f2fb(0xda)](_0x6d5158);break;case SocksSessionState[_0xd5f2fb(0x8e)]:yield this[_0xd5f2fb(0xc2)](_0x6d5158);break;case SocksSessionState[_0xd5f2fb(0xaf)]:this[_0xd5f2fb(0xa9)](_0x6d5158);break;case SocksSessionState[_0xd5f2fb(0xdf)]:break;}}),this[_0x371d00(0xc6)]=_0x53f8e8,this['logger']=_0xf4ef28,this[_0x371d00(0xd9)]=_0x2bd363,this[_0x371d00(0x99)]=new SessionMonitor_1['SessionMonitor'](_0x44472e),this[_0x371d00(0xa1)]['info']('Initialize\x20new\x20session'),this[_0x371d00(0xc6)][_0x371d00(0xca)][_0x371d00(0x90)]['method']===_0x371d00(0xd1)?this[_0x371d00(0x98)]=new Auth_1[(_0x371d00(0xb2))](this[_0x371d00(0xc6)][_0x371d00(0xca)]['credentials']):this[_0x371d00(0x98)]=null,this[_0x371d00(0xa7)]=this[_0x371d00(0xa7)][_0x371d00(0x9b)](this),this[_0x371d00(0xc9)]=_0x44472e,this['udpPort']=this[_0x371d00(0xae)](),this[_0x371d00(0xa1)][_0x371d00(0xa4)](_0x371d00(0xa3)+this[_0x371d00(0xdd)]),this[_0x371d00(0xc9)]['on'](_0x371d00(0xc1),this[_0x371d00(0xe4)]),this[_0x371d00(0xc9)]['on']('close',this[_0x371d00(0xa7)]),this[_0x371d00(0xc9)]['on'](_0x371d00(0xa2),this[_0x371d00(0xa7)]);}[a10_0x2ae527(0xda)](_0x2492af){const _0x585315=a10_0x2ae527,_0x3959cd=_0x2492af[0x0],_0x592dce=_0x2492af[0x1],_0x29fffa=_0x2492af[_0x585315(0xa8)](0x2,0x2+_0x592dce);if(_0x3959cd!==0x5){this['clientSocket'][_0x585315(0x97)]();return;}if(_0x29fffa[_0x585315(0xe6)](0x2)&&this['authHandler']instanceof Auth_1['UserPassAuth'])this['clientSocket'][_0x585315(0xbd)](Buffer[_0x585315(0xbc)]([0x5,0x2])),this[_0x585315(0xd0)]=!![],this[_0x585315(0xa1)][_0x585315(0xa4)](_0x585315(0xba));else _0x29fffa[_0x585315(0xe6)](0x0&&this['authHandler']===null)?(this[_0x585315(0xc9)][_0x585315(0xbd)](Buffer['from']([0x5,0x0])),this[_0x585315(0xd0)]=!![],this['logger'][_0x585315(0xa4)](_0x585315(0xba))):(this[_0x585315(0xc9)][_0x585315(0xbd)](Buffer['from']([0x5,0xff])),this['clientSocket'][_0x585315(0x97)]());this['state']=this[_0x585315(0x98)]?SocksSessionState[_0x585315(0x8e)]:SocksSessionState[_0x585315(0xaf)];}[a10_0x2ae527(0xc2)](_0x27ba4d){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x373c2e=a10_0x632b,_0x32044e=this[_0x373c2e(0xc9)][_0x373c2e(0xbf)]||'';let _0x1f3cc7;if(this[_0x373c2e(0x98)]){_0x1f3cc7=yield this[_0x373c2e(0x98)][_0x373c2e(0x92)](_0x373c2e(0x9e),{'socket':this['clientSocket'],'data':_0x27ba4d});if(_0x1f3cc7){this[_0x373c2e(0xa1)]['info'](_0x373c2e(0xd4));const _0x292646=Buffer['from']([0x5,0x0]);this[_0x373c2e(0xc9)][_0x373c2e(0xbd)](_0x292646),this[_0x373c2e(0x98)]=null;}else{this[_0x373c2e(0xd9)](_0x32044e);const _0x23a51e=Buffer[_0x373c2e(0xbc)]([0x5,0x1]);this['logger'][_0x373c2e(0xa4)]('Failed\x20authentication'),this['clientSocket'][_0x373c2e(0xbd)](_0x23a51e),this['clientSocket']['end']();}}else{_0x1f3cc7=!![];const _0x4dbfab=Buffer['from']([0x5,0x0]);this[_0x373c2e(0xc9)][_0x373c2e(0xbd)](_0x4dbfab);}_0x1f3cc7&&(this[_0x373c2e(0xd8)]=SocksSessionState[_0x373c2e(0xaf)]);});}[a10_0x2ae527(0xa9)](_0x3b38c9){const _0x355e0b=a10_0x2ae527,{host:_0x19d5b0,port:_0x1cfa25}=(0x0,utils_1[_0x355e0b(0xc4)])(_0x3b38c9);this[_0x355e0b(0xb8)](_0x19d5b0,()=>{const _0x7975c4=_0x355e0b,_0x211a8b=_0x3b38c9[0x1];switch(_0x211a8b){case 0x1:this[_0x7975c4(0xa1)][_0x7975c4(0xa4)](_0x7975c4(0x96)),this[_0x7975c4(0xb5)]=new ConnectCommandHandler_1[(_0x7975c4(0xb4))](this['clientSocket'],_0x3b38c9,this[_0x7975c4(0xc6)],this[_0x7975c4(0xa1)]),this[_0x7975c4(0xd8)]=SocksSessionState[_0x7975c4(0xdf)];break;case 0x2:this[_0x7975c4(0xa1)][_0x7975c4(0xa4)](_0x7975c4(0x94)),this[_0x7975c4(0xb5)]=new BindCommandHandler_1[(_0x7975c4(0x9f))](this['clientSocket'],_0x3b38c9,this['configManager'],this[_0x7975c4(0xa1)]),this[_0x7975c4(0xd8)]=SocksSessionState[_0x7975c4(0xdf)];break;case 0x3:this[_0x7975c4(0xa1)][_0x7975c4(0xa4)](_0x7975c4(0x8d)),this[_0x7975c4(0xb5)]=new UDPAssociateCommandHandler_1[(_0x7975c4(0xc0))](this['clientSocket'],_0x3b38c9,this[_0x7975c4(0xc6)],this[_0x7975c4(0xdd)],this[_0x7975c4(0xa1)]),this[_0x7975c4(0xd8)]=SocksSessionState['DataRelayMode'];break;}});}['filterAccess'](_0x4ea9b6,_0x208656){const _0x12dcea=a10_0x2ae527;if(this[_0x12dcea(0xe3)](_0x4ea9b6)){this[_0x12dcea(0xa1)][_0x12dcea(0xa4)](_0x12dcea(0xdc)+_0x4ea9b6+_0x12dcea(0xb9)),this['clientSocket'][_0x12dcea(0x97)]();return;}if(!this[_0x12dcea(0xde)](_0x4ea9b6)){this['logger'][_0x12dcea(0xa4)](_0x12dcea(0xdc)+_0x4ea9b6+'\x20not\x20allowed\x20by\x20server\x20policy'),this[_0x12dcea(0xc9)][_0x12dcea(0x97)]();return;}_0x208656();}[a10_0x2ae527(0xde)](_0xb56dde){const _0xd35c2d=a10_0x2ae527,_0x12d17a=this['configManager'][_0xd35c2d(0xca)]['serverIpFiltering'][_0xd35c2d(0xe5)];if(!_0x12d17a||_0x12d17a[_0xd35c2d(0xa5)]===0x0)return!![];return _0x12d17a[_0xd35c2d(0xe6)](_0xb56dde);}['isBlockedIP'](_0x292fa6){const _0x59fa5e=a10_0x2ae527;return this['configManager']['config'][_0x59fa5e(0xbe)]['blacklist']['includes'](_0x292fa6);}[a10_0x2ae527(0xae)](){const _0x25724a=a10_0x2ae527;for(let _0x2eab63=this[_0x25724a(0xc6)]['config'][_0x25724a(0xc5)][_0x25724a(0x9e)]['udpPortRange'][_0x25724a(0x9a)];_0x2eab63<=this[_0x25724a(0xc6)][_0x25724a(0xca)][_0x25724a(0xc5)]['socks5'][_0x25724a(0xd7)][_0x25724a(0xc8)];_0x2eab63++){if(!SocksSession[_0x25724a(0xb3)][_0x25724a(0xc3)](_0x2eab63))return SocksSession[_0x25724a(0xb3)][_0x25724a(0xd2)](_0x2eab63),_0x2eab63;}throw new Error('No\x20available\x20UDP\x20ports');}['sessionCleanup'](){const _0x3c1f8d=a10_0x2ae527;SocksSession[_0x3c1f8d(0xb3)][_0x3c1f8d(0xb0)](this[_0x3c1f8d(0xdd)]),this[_0x3c1f8d(0xc9)]&&!this[_0x3c1f8d(0xc9)]['destroyed']&&this[_0x3c1f8d(0xc9)]['end'](),this[_0x3c1f8d(0xa1)][_0x3c1f8d(0xa4)](_0x3c1f8d(0xe0));}}exports['SocksSession']=SocksSession,SocksSession[a10_0x2ae527(0xb3)]=new Set();