'use strict';const a9_0x40fe9=a9_0x139b;function a9_0x139b(_0x232c44,_0x51f70e){const _0xaf5953=a9_0xaf59();return a9_0x139b=function(_0x139b71,_0x498dd3){_0x139b71=_0x139b71-0x182;let _0xa99f29=_0xaf5953[_0x139b71];return _0xa99f29;},a9_0x139b(_0x232c44,_0x51f70e);}(function(_0x354664,_0x3283e9){const _0xfcc807=a9_0x139b,_0x52ca12=_0x354664();while(!![]){try{const _0x58dd72=-parseInt(_0xfcc807(0x1e9))/0x1+-parseInt(_0xfcc807(0x1b6))/0x2*(parseInt(_0xfcc807(0x1de))/0x3)+parseInt(_0xfcc807(0x1a8))/0x4*(parseInt(_0xfcc807(0x18c))/0x5)+parseInt(_0xfcc807(0x197))/0x6+-parseInt(_0xfcc807(0x1bb))/0x7+-parseInt(_0xfcc807(0x1b8))/0x8*(-parseInt(_0xfcc807(0x185))/0x9)+-parseInt(_0xfcc807(0x1b2))/0xa*(-parseInt(_0xfcc807(0x1a3))/0xb);if(_0x58dd72===_0x3283e9)break;else _0x52ca12['push'](_0x52ca12['shift']());}catch(_0x4c8c1f){_0x52ca12['push'](_0x52ca12['shift']());}}}(a9_0xaf59,0xc0814));function a9_0xaf59(){const _0x544cec=['split','33YTvaaO','writeUInt16BE','processCommand','handleUdpDatagram','Message\x20above\x20is\x20from\x20remote\x20server','148012SFclaL','toString','\x20and\x20listening\x20on\x20port\x20','__setModuleDefault','findSessionByDestination','destinationPort','UDP\x20socket\x20closed','set','isIPv6','session:','2771060PZaTQI','Message\x20above\x20forwarded\x20to\x20remote\x20server','slice','close','86512qQdzxw','rinfo\x20port:','713192LVJNAD','dgram','next','10538150NgDhQc','debug','send','configManager','Message\x20above\x20is\x20from\x20client','Cleaning\x20UDP\x20command\x20handler','UdpAssociateHandler','sendUdpAssociateResponse','Rinfo\x20:','sendToClient','clientAddress','UDP\x20socket\x20error:','clientSessions','message','__esModule','__importStar','from','server','listenForUdpDatagrams','entries','udpPort','match','throw','bind','createUdpAssociateResponse','net','flatMap','clientPort','prototype','getOwnPropertyDescriptor','copy','writable','Error\x20sending\x20to\x20remote\x20server:','defineProperty','concat','30dUneFs','Error\x20sending\x20UDP\x20associate\x20response:','address','clientSocket','Error\x20processing\x20UDP\x20associate\x20command:\x20rinfo\x20not\x20provided','isSocketClosed','map','config','udp4','logger','length','511746EEzPmo','CommandHandler','session.clientAddress:','__awaiter','default','153XciKzH','socks5','determinePayloadStartIndex','__createBinding','destinationAddress','Sessions:','value','5XcqDre','Message\x20above\x20forwarded\x20to\x20client','port','Received\x20UDP\x20message\x20from\x20','../utils','done','sendToRemoteServer','./CommandHandler','info','cleanup','rinfo\x20address:','5126412THgqsq','error','fill','create','serverIP','isSocks5Message','configurable','get','udpSocket','Error\x20processing\x20UDP\x20associate\x20command:','alloc'];a9_0xaf59=function(){return _0x544cec;};return a9_0xaf59();}var __createBinding=this&&this[a9_0x40fe9(0x188)]||(Object['create']?function(_0x8a0d3a,_0x2a27d7,_0x415d77,_0x1be3d5){const _0x543425=a9_0x40fe9;if(_0x1be3d5===undefined)_0x1be3d5=_0x415d77;var _0x5afb49=Object[_0x543425(0x1d8)](_0x2a27d7,_0x415d77);(!_0x5afb49||(_0x543425(0x19e)in _0x5afb49?!_0x2a27d7[_0x543425(0x1c9)]:_0x5afb49[_0x543425(0x1da)]||_0x5afb49[_0x543425(0x19d)]))&&(_0x5afb49={'enumerable':!![],'get':function(){return _0x2a27d7[_0x415d77];}}),Object[_0x543425(0x1dc)](_0x8a0d3a,_0x1be3d5,_0x5afb49);}:function(_0x248862,_0x15ee46,_0x3ae6ae,_0x16ad13){if(_0x16ad13===undefined)_0x16ad13=_0x3ae6ae;_0x248862[_0x16ad13]=_0x15ee46[_0x3ae6ae];}),__setModuleDefault=this&&this[a9_0x40fe9(0x1ab)]||(Object[a9_0x40fe9(0x19a)]?function(_0x1848c7,_0x5982d6){const _0x39b37c=a9_0x40fe9;Object[_0x39b37c(0x1dc)](_0x1848c7,'default',{'enumerable':!![],'value':_0x5982d6});}:function(_0x644bb3,_0x1d36cb){const _0x48f13e=a9_0x40fe9;_0x644bb3[_0x48f13e(0x184)]=_0x1d36cb;}),__importStar=this&&this[a9_0x40fe9(0x1ca)]||function(_0x23da12){const _0x72b9fa=a9_0x40fe9;if(_0x23da12&&_0x23da12[_0x72b9fa(0x1c9)])return _0x23da12;var _0x1e9782={};if(_0x23da12!=null){for(var _0x1fb152 in _0x23da12)if(_0x1fb152!==_0x72b9fa(0x184)&&Object[_0x72b9fa(0x1d7)]['hasOwnProperty']['call'](_0x23da12,_0x1fb152))__createBinding(_0x1e9782,_0x23da12,_0x1fb152);}return __setModuleDefault(_0x1e9782,_0x23da12),_0x1e9782;},__awaiter=this&&this[a9_0x40fe9(0x183)]||function(_0x457179,_0x2a3283,_0x1dc9b9,_0x5b89c0){function _0x5b8423(_0x48c455){return _0x48c455 instanceof _0x1dc9b9?_0x48c455:new _0x1dc9b9(function(_0x33d5cf){_0x33d5cf(_0x48c455);});}return new(_0x1dc9b9||(_0x1dc9b9=Promise))(function(_0xf9b15d,_0x117c43){const _0x3fcfca=a9_0x139b;function _0xbde414(_0x6e0f63){try{_0x4fc604(_0x5b89c0['next'](_0x6e0f63));}catch(_0xcc6af7){_0x117c43(_0xcc6af7);}}function _0x599c82(_0x3c802d){const _0x478737=a9_0x139b;try{_0x4fc604(_0x5b89c0[_0x478737(0x1d1)](_0x3c802d));}catch(_0x3f2707){_0x117c43(_0x3f2707);}}function _0x4fc604(_0x183e71){const _0x2db10b=a9_0x139b;_0x183e71[_0x2db10b(0x191)]?_0xf9b15d(_0x183e71[_0x2db10b(0x18b)]):_0x5b8423(_0x183e71[_0x2db10b(0x18b)])['then'](_0xbde414,_0x599c82);}_0x4fc604((_0x5b89c0=_0x5b89c0['apply'](_0x457179,_0x2a3283||[]))[_0x3fcfca(0x1ba)]());});};Object['defineProperty'](exports,a9_0x40fe9(0x1c9),{'value':!![]}),exports[a9_0x40fe9(0x1c1)]=void 0x0;const net=__importStar(require(a9_0x40fe9(0x1d4))),dgram=__importStar(require(a9_0x40fe9(0x1b9))),CommandHandler_1=require(a9_0x40fe9(0x193)),utils_1=require(a9_0x40fe9(0x190));;class UdpAssociateHandler extends CommandHandler_1[a9_0x40fe9(0x1ea)]{constructor(_0x190d6b,_0x398f2b,_0x4f6a91,_0x4c2bc3,_0x1a75d6){const _0x53bf8f=a9_0x40fe9;super(_0x190d6b,_0x398f2b,_0x4f6a91,_0x1a75d6),this['isSocketClosed']=![],this[_0x53bf8f(0x1cf)]=_0x4c2bc3,this[_0x53bf8f(0x19f)]=dgram['createSocket'](_0x53bf8f(0x1e6)),this[_0x53bf8f(0x1c7)]=new Map(),this[_0x53bf8f(0x1cd)](),this['processCommand'](),this[_0x53bf8f(0x1e1)]['on']('close',()=>{this['cleanup']();});}[a9_0x40fe9(0x1a5)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2bbb1c=a9_0x139b;try{yield this['sendUdpAssociateResponse'](this['udpPort']);}catch(_0x30c743){this[_0x2bbb1c(0x1e7)]['error'](_0x2bbb1c(0x1a0),_0x30c743);}});}[a9_0x40fe9(0x1c2)](_0x2af270){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xb5d63=a9_0x139b,_0x102d67=this[_0xb5d63(0x1d3)](_0x2af270);this[_0xb5d63(0x1e1)]['write'](_0x102d67,_0x438d1a=>{const _0x4a4422=_0xb5d63;_0x438d1a&&this[_0x4a4422(0x1e7)][_0x4a4422(0x198)](_0x4a4422(0x1df),_0x438d1a);});});}[a9_0x40fe9(0x1d3)](_0x1313bf){const _0x3aaf82=a9_0x40fe9,_0x2b1fa4=this['configManager'][_0x3aaf82(0x1e5)]['server'][_0x3aaf82(0x186)]['serverIP'],_0x33af9d=Buffer[_0x3aaf82(0x1cb)](_0x2b1fa4[_0x3aaf82(0x1a2)]('.')[_0x3aaf82(0x1e4)](Number)),_0x3dd424=Buffer['alloc'](0xa);return _0x3dd424[0x0]=0x5,_0x3dd424[0x1]=0x0,_0x3dd424[0x2]=0x0,_0x3dd424[0x3]=0x1,_0x33af9d[_0x3aaf82(0x1d9)](_0x3dd424,0x4),_0x3dd424[_0x3aaf82(0x1a4)](_0x1313bf,0x8),_0x3dd424;}[a9_0x40fe9(0x1cd)](){const _0x4f8877=a9_0x40fe9;this[_0x4f8877(0x19f)][_0x4f8877(0x1d2)]({'port':this[_0x4f8877(0x1cf)],'address':this[_0x4f8877(0x1be)]['config'][_0x4f8877(0x1cc)][_0x4f8877(0x186)][_0x4f8877(0x19b)]},()=>{const _0x310bc5=_0x4f8877;this[_0x310bc5(0x1e7)][_0x310bc5(0x194)]('UDP\x20socket\x20bound\x20to\x20'+this[_0x310bc5(0x1be)]['config'][_0x310bc5(0x1cc)]['socks5'][_0x310bc5(0x19b)]+_0x310bc5(0x1aa)+this[_0x310bc5(0x1cf)]);}),this[_0x4f8877(0x19f)]['on'](_0x4f8877(0x1c8),(_0x2402c0,_0x599c43)=>{const _0x1246ea=_0x4f8877;this[_0x1246ea(0x1e7)][_0x1246ea(0x1bc)](_0x1246ea(0x18f)+_0x599c43['address']+':'+_0x599c43[_0x1246ea(0x18e)]+':\x20'+_0x2402c0[_0x1246ea(0x1a9)]('hex')),this['handleUdpDatagram'](_0x2402c0,_0x599c43);}),this['udpSocket']['on']('error',_0x2ced9b=>{const _0x3fe970=_0x4f8877;this[_0x3fe970(0x1e7)][_0x3fe970(0x198)](_0x3fe970(0x1c6),_0x2ced9b),this[_0x3fe970(0x195)]();}),this[_0x4f8877(0x19f)]['on']('close',()=>{const _0x5d0d52=_0x4f8877;this[_0x5d0d52(0x1e7)][_0x5d0d52(0x194)](_0x5d0d52(0x1ae)),this['cleanup']();});}[a9_0x40fe9(0x1a6)](_0xc7697f,_0x4d6285){const _0x1ed623=a9_0x40fe9;if(_0x4d6285)try{this[_0x1ed623(0x1e7)]['debug']('Msg\x20:',_0xc7697f),this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)](_0x1ed623(0x1c3),_0x4d6285);const _0x3bc9ea=_0x4d6285[_0x1ed623(0x1e0)]+':'+_0x4d6285[_0x1ed623(0x18e)];let _0x3c53b1=this[_0x1ed623(0x1c7)][_0x1ed623(0x19e)](_0x3bc9ea);this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)](_0x1ed623(0x18a),this['clientSessions']),this['logger'][_0x1ed623(0x1bc)]('clientKey:',_0x3bc9ea),this['logger']['debug'](_0x1ed623(0x1b1),_0x3c53b1);if(!_0x3c53b1&&this[_0x1ed623(0x19c)](_0xc7697f)){const {host:_0xa6610b,port:_0x4cfd09}=(0x0,utils_1['parseDestination'])(_0xc7697f);_0x3c53b1={'clientAddress':_0x4d6285[_0x1ed623(0x1e0)],'clientPort':_0x4d6285[_0x1ed623(0x18e)],'destinationAddress':_0xa6610b,'destinationPort':_0x4cfd09},this[_0x1ed623(0x1c7)][_0x1ed623(0x1af)](_0x3bc9ea,_0x3c53b1);}else _0x3c53b1=this[_0x1ed623(0x1ac)](_0x4d6285[_0x1ed623(0x1e0)],_0x4d6285[_0x1ed623(0x18e)]);if(_0x3c53b1){this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)](_0x1ed623(0x196),_0x4d6285[_0x1ed623(0x1e0)]),this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)](_0x1ed623(0x1b7),_0x4d6285[_0x1ed623(0x18e)]),this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)](_0x1ed623(0x182),_0x3c53b1[_0x1ed623(0x1c5)]),this[_0x1ed623(0x1e7)]['debug']('session.clientPort:',_0x3c53b1[_0x1ed623(0x1d6)]),this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)]('session.destinationAddress:',_0x3c53b1[_0x1ed623(0x189)]),this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)]('session.destinationPort:',_0x3c53b1[_0x1ed623(0x1ad)]);if(_0x4d6285[_0x1ed623(0x1e0)]===_0x3c53b1[_0x1ed623(0x1c5)]&&_0x4d6285[_0x1ed623(0x18e)]===_0x3c53b1[_0x1ed623(0x1d6)])this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)](_0x1ed623(0x1bf)),this[_0x1ed623(0x19c)](_0xc7697f)&&(this[_0x1ed623(0x192)](_0xc7697f,_0x3c53b1),this['logger'][_0x1ed623(0x1bc)](_0x1ed623(0x1b3)));else _0x3c53b1[_0x1ed623(0x189)]===_0x4d6285['address']&&_0x3c53b1[_0x1ed623(0x1ad)]===_0x4d6285[_0x1ed623(0x18e)]&&(this[_0x1ed623(0x1e7)][_0x1ed623(0x1bc)](_0x1ed623(0x1a7)),this[_0x1ed623(0x1c4)](_0xc7697f,_0x3c53b1),this[_0x1ed623(0x1e7)]['debug'](_0x1ed623(0x18d)));}}catch(_0x4d06dd){this[_0x1ed623(0x1e7)][_0x1ed623(0x198)](_0x1ed623(0x1a0),_0x4d06dd);}else this[_0x1ed623(0x1e7)]['error'](_0x1ed623(0x1e2));}[a9_0x40fe9(0x19c)](_0x135576){const _0x53e806=a9_0x40fe9;return _0x135576[_0x53e806(0x1e8)]>0xa&&(_0x135576[0x3]===0x1||_0x135576[0x3]===0x3||_0x135576[0x3]===0x4);}[a9_0x40fe9(0x1ac)](_0x5c447a,_0x121ece){const _0x9bc6e5=a9_0x40fe9;for(let [_0x1e9225,_0x767e4]of this[_0x9bc6e5(0x1c7)][_0x9bc6e5(0x1ce)]()){if(_0x767e4[_0x9bc6e5(0x189)]===_0x5c447a&&_0x767e4[_0x9bc6e5(0x1ad)]===_0x121ece)return _0x767e4;}return undefined;}[a9_0x40fe9(0x192)](_0x1e8cd9,_0x4aa462){const _0x40b3a2=a9_0x40fe9,_0x58e353=(0x0,utils_1[_0x40b3a2(0x187)])(_0x1e8cd9),_0x22a971=_0x1e8cd9[_0x40b3a2(0x1b4)](_0x58e353);_0x4aa462[_0x40b3a2(0x189)]&&_0x4aa462[_0x40b3a2(0x1ad)]&&this[_0x40b3a2(0x19f)][_0x40b3a2(0x1bd)](_0x22a971,_0x4aa462['destinationPort'],_0x4aa462[_0x40b3a2(0x189)],_0x401b41=>{const _0x43d5c4=_0x40b3a2;_0x401b41&&this[_0x43d5c4(0x1e7)][_0x43d5c4(0x198)](_0x43d5c4(0x1db),_0x401b41),this[_0x43d5c4(0x1e7)]['info']('Send\x20to\x20remote\x20server\x20at\x20'+_0x4aa462[_0x43d5c4(0x189)]+':'+_0x4aa462[_0x43d5c4(0x1ad)]);});}[a9_0x40fe9(0x1c4)](_0x3caa5f,_0x330ae5){const _0x46bed6=a9_0x40fe9;if(_0x330ae5&&_0x330ae5[_0x46bed6(0x1c5)]&&_0x330ae5[_0x46bed6(0x1d6)]){const _0x51e45b=this['constructSocks5Response'](_0x3caa5f,_0x330ae5[_0x46bed6(0x1c5)],_0x330ae5['clientPort']);this[_0x46bed6(0x19f)][_0x46bed6(0x1bd)](_0x51e45b,_0x330ae5[_0x46bed6(0x1d6)],_0x330ae5[_0x46bed6(0x1c5)],_0x3d373f=>{const _0x2da1be=_0x46bed6;_0x3d373f&&this['logger'][_0x2da1be(0x198)]('Error\x20sending\x20to\x20client:',_0x3d373f),this[_0x2da1be(0x1e7)]['info']('Send\x20to\x20client\x20at\x20'+_0x330ae5['clientAddress']+':'+_0x330ae5[_0x2da1be(0x1d6)]);});}}['constructSocks5Response'](_0xeed4fd,_0x28c073,_0x358603){const _0x256b04=a9_0x40fe9,_0x1aefc9=Buffer[_0x256b04(0x1a1)](0x2),_0x15faeb=Buffer['from']([0x0]),_0x131c88=net[_0x256b04(0x1b0)](_0x28c073)?0x4:0x1,_0x29bb2a=net[_0x256b04(0x1b0)](_0x28c073)?this['convertIPv6Address'](_0x28c073):Buffer['from'](_0x28c073['split']('.')[_0x256b04(0x1e4)](Number)),_0x276090=Buffer[_0x256b04(0x1a1)](0x2);return _0x276090[_0x256b04(0x1a4)](_0x358603,0x0),Buffer[_0x256b04(0x1dd)]([_0x1aefc9,_0x15faeb,Buffer['from']([_0x131c88]),_0x29bb2a,_0x276090,_0xeed4fd]);}['convertIPv6Address'](_0x6c30a){const _0x3c73e9=a9_0x40fe9;return Buffer[_0x3c73e9(0x1cb)](_0x6c30a[_0x3c73e9(0x1a2)](':')[_0x3c73e9(0x1d5)](_0x2b4a59=>{const _0x5a74f6=_0x3c73e9;if(_0x2b4a59[_0x5a74f6(0x1e8)]===0x0)return Array(0x4)[_0x5a74f6(0x199)](0x0);else{const _0x4bec1a=_0x2b4a59[_0x5a74f6(0x1d0)](/.{1,2}/g)||[];return _0x4bec1a[_0x5a74f6(0x1e4)](_0x219e66=>parseInt(_0x219e66,0x10));}}));}[a9_0x40fe9(0x195)](){const _0x575d77=a9_0x40fe9;this[_0x575d77(0x1e7)][_0x575d77(0x194)](_0x575d77(0x1c0));if(this['isSocketClosed'])return;this[_0x575d77(0x1e3)]=!![],this[_0x575d77(0x19f)]['removeAllListeners'](),this[_0x575d77(0x19f)][_0x575d77(0x1b5)](()=>{const _0x2bad21=_0x575d77;this[_0x2bad21(0x1e7)]['info']('UDP\x20socket\x20closed.');}),super[_0x575d77(0x195)]();}}exports['UdpAssociateHandler']=UdpAssociateHandler;